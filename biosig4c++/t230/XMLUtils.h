/****************************************************************************
*   File:       XMLUtils.h
*   Author:     S. Skorokhdov
*
*   Description:
*       Singleton wrapper class for Xerces-C/Xalan-C for biosig4c++ library.
*****************************************************************************
*/
#pragma once
#ifndef _XMLUTILS_H_
#define _XMLUTILS_H_
//---------------------------------------------------------------------------
#include <xercesc/dom/DOM.hpp>
#include <xqilla/xqilla-dom3.hpp>
//---------------------------------------------------------------------------
namespace BioSig
{
//===========================================================================
//  
//===========================================================================
class aECGXMLUtils
{
    //  Access function for singleton XML utilities for aECG parsing/creation
    friend class aECGXML;
    //-----------------------------------------------------------------------
public:
    //=======================================================================
    //  Translated exception classes
    //=======================================================================
    class xml_err {};
    //-----------------------------------------------------------------------
    class dom_err {};
    //-----------------------------------------------------------------------
    class xpath_err {};
    //-----------------------------------------------------------------------
    class unexp_err {};
    //-----------------------------------------------------------------------
    class no_doc {};
    //=======================================================================
    //  Public interface
    //=======================================================================
    aECGXMLUtils();
    //-----------------------------------------------------------------------
    ~aECGXMLUtils();
    //-----------------------------------------------------------------------
    XERCES_CPP_NAMESPACE::DOMImplementation *getCompatableImplementation();
    //-----------------------------------------------------------------------
    XERCES_CPP_NAMESPACE::DOMBuilder *getCompatableParser();
    //-----------------------------------------------------------------------
    void parseURI( const char *uri );
    //-----------------------------------------------------------------------
    void detachDoc();
    //-----------------------------------------------------------------------
    XERCES_CPP_NAMESPACE::DOMDocument *getParsedDoc( const char *uri );
    //-----------------------------------------------------------------------
    XQillaNSResolver *getCompatableNSResolver();
    //-----------------------------------------------------------------------
    XPath2Result *selectNodeSet( const char *pexpr, XERCES_CPP_NAMESPACE::DOMNode *pcontext );
    //-----------------------------------------------------------------------
    //-----------------------------------------------------------------------

private:
    //=======================================================================
    //  private methods
    //=======================================================================
    void init_();
    //-----------------------------------------------------------------------
    void clean_up_doc_();
    //-----------------------------------------------------------------------
    void do_parse_uri_( const char *);
    //-----------------------------------------------------------------------
    XPath2Result *do_select_node_iterator_( const char *, XERCES_CPP_NAMESPACE::DOMNode * );
    //=======================================================================
    //  private data
    //=======================================================================
    XERCES_CPP_NAMESPACE::DOMImplementation    *pdomimpl_;
    XERCES_CPP_NAMESPACE::DOMBuilder           *pparser_;
    XERCES_CPP_NAMESPACE::DOMDocument          *pdoc_;
    XQillaNSResolver   *presolver_;
};  //  class aECGXMLUtils
//===========================================================================
//  Singleton class
//===========================================================================
class aECGXML
{
public:
    static aECGXMLUtils *instance();
};
//---------------------------------------------------------------------------
}   //  namespace BioSig
//---------------------------------------------------------------------------
#endif /* ifndef _XMLUTILS_H_ */
